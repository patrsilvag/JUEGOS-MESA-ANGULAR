<section class="form-container">

  <h2 class="form-title">Recuperar contrase√±a</h2>

  <!-- FORMULARIO √öNICO (muy importante) -->
  <form [formGroup]="form" novalidate>

    <!-- ============================
         PASO 1 ‚Äî INGRESAR CORREO
    ============================ -->
    <div *ngIf="paso === 1" class="form-block">

      <label>Correo electr√≥nico:</label>
      <input
        type="email"
        class="form-control"
        formControlName="correo"
        placeholder="Ej: usuario@gmail.com"
      />

      <small *ngIf="campo('correo').touched && campo('correo').invalid" class="error">
        Ingresa un correo v√°lido.
      </small>

      <button type="button" class="btn-primary mt-3" (click)="enviarCorreo()">
        Enviar c√≥digo
      </button>

    </div>

    <!-- ============================
         PASO 2 ‚Äî VERIFICAR C√ìDIGO
    ============================ -->
    <div *ngIf="paso === 2" class="form-block">

      <p class="text-center mb-2">
        Ingresa el c√≥digo enviado a tu correo.
      </p>

      <label>C√≥digo de verificaci√≥n:</label>
      <input
        type="text"
        maxlength="6"
        class="form-control"
        formControlName="code"
        placeholder="123456"
      />

      <small *ngIf="campo('code').errors?.['required']" class="error">Debes ingresar un c√≥digo.</small>
      <small *ngIf="campo('code').errors?.['minlength']" class="error">Debe tener 6 d√≠gitos.</small>
      <small *ngIf="campo('code').errors?.['pattern']" class="error">Solo n√∫meros.</small>
      <small *ngIf="campo('code').errors?.['incorrecto']" class="error">C√≥digo incorrecto.</small>

      <button type="button" class="btn-primary mt-3" (click)="verificarCodigo()">
        Validar c√≥digo
      </button>

      <p class="text-center mt-3">
        <a style="cursor:pointer" (click)="paso = 1">‚Üê Cambiar correo</a>
      </p>

    </div>

    <!-- ============================
         PASO 3 ‚Äî NUEVA CLAVE
    ============================ -->
    <div *ngIf="paso === 3" class="form-block">

      <label>Nueva contrase√±a:</label>
      <div class="password-group">
        <input
          [type]="verClave ? 'text' : 'password'"
          class="form-control"
          formControlName="nuevaClave"
        />
        <button type="button" class="btn-ojo" (click)="verClave = !verClave">üëÅÔ∏è</button>
      </div>

      <div class="reglas" *ngIf="campo('nuevaClave').touched">
        <span [class.ok]="!campo('nuevaClave').errors?.['minlength']">M√≠n. 6</span>
        <span [class.ok]="!campo('nuevaClave').errors?.['uppercase']">May√∫scula</span>
        <span [class.ok]="!campo('nuevaClave').errors?.['number']">N√∫mero</span>
        <span [class.ok]="!campo('nuevaClave').errors?.['special']">Especial</span>
      </div>

      <label>Repetir contrase√±a:</label>
      <div class="password-group">
        <input
          [type]="verClave2 ? 'text' : 'password'"
          class="form-control"
          formControlName="repetirClave"
        />
        <button type="button" class="btn-ojo" (click)="verClave2 = !verClave2">üëÅÔ∏è</button>
      </div>

      <small *ngIf="form.errors?.['noCoinciden'] && campo('repetirClave').touched" class="error">
        Las contrase√±as no coinciden.
      </small>

      <button type="button" class="btn-primary mt-3" (click)="actualizarClave()">
        Actualizar contrase√±a
      </button>

      <p class="text-center mt-3">
        <a style="cursor:pointer" (click)="paso = 2">‚Üê Volver</a>
      </p>

    </div>

  </form>

  <!-- √âXITO -->
  <div *ngIf="mensajeExito" class="alert alert-success text-center mt-3">
    ‚úî Tu contrase√±a fue actualizada correctamente.
  </div>

</section>
